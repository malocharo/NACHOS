<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nachos: filesys/filesys.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nachos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_386a01e8c60160d2cb79aec927decd2f.html">filesys</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">filesys.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="system_8h_source.html">kernel/system.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="msgerror_8h_source.html">kernel/msgerror.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="disk_8h_source.html">machine/disk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">utility/config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="bitmap_8h_source.html">utility/bitmap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="directory_8h_source.html">filesys/directory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="filehdr_8h_source.html">filesys/filehdr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="filesys_8h_source.html">filesys/filesys.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="oftable_8h_source.html">filesys/oftable.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for filesys.cc:</div>
<div class="dyncontent">
<div class="center"><img src="filesys_8cc__incl.png" border="0" usemap="#filesys_2filesys_8cc" alt=""/></div>
<map name="filesys_2filesys_8cc" id="filesys_2filesys_8cc">
<area shape="rect" id="node2" href="system_8h.html" title="Global variables used in Nachos. " alt="" coords="100,665,215,691"/>
<area shape="rect" id="node13" href="msgerror_8h.html" title="Defines the data structure to store error messages during a syscall process. " alt="" coords="1651,79,1776,104"/>
<area shape="rect" id="node14" href="disk_8h.html" title="Data structures to emulate a physical disk. " alt="" coords="1365,372,1475,397"/>
<area shape="rect" id="node15" href="config_8h.html" title="Data structures for setting up the Nachos hardware and software configuration. " alt="" coords="341,445,443,471"/>
<area shape="rect" id="node17" href="filesys_8h.html" title="Data structures to represent the Nachos file system. " alt="" coords="901,519,1011,544"/>
<area shape="rect" id="node19" href="bitmap_8h.html" title="Data structures defining a bitmap. " alt="" coords="669,519,776,544"/>
<area shape="rect" id="node20" href="directory_8h.html" title="Data structures to manage a UNIX&#45;like directory of file names. " alt="" coords="1600,519,1723,544"/>
<area shape="rect" id="node21" href="filehdr_8h.html" title="Data structures for managing a disk file header. " alt="" coords="1366,299,1474,324"/>
<area shape="rect" id="node22" href="oftable_8h.html" title="Data structure used to synchronize operations on files. " alt="" coords="1198,79,1311,104"/>
<area shape="rect" id="node6" href="list_8h.html" title="Data structures to manage LISP&#45;like lists. " alt="" coords="727,812,809,837"/>
<area shape="rect" id="node12" href="objid_8h.html" title="Object identifier data structure. " alt="" coords="195,739,290,764"/>
<area shape="rect" id="node7" href="copyright_8h.html" title="Nachos copyright notice Copyright (c) 1992&#45;1993 The Regents of the University of California. All rights reserved. " alt="" coords="1033,1032,1159,1057"/>
<area shape="rect" id="node8" href="utility_8h.html" title="Miscellaneous useful definitions, including debugging routines. " alt="" coords="384,885,480,911"/>
<area shape="rect" id="node10" href="sysdep_8h.html" title="System&#45;dependent interface. " alt="" coords="194,959,323,984"/>
<area shape="rect" id="node16" href="translationtable_8h.html" title="Data structures for managing address translation. " alt="" coords="368,592,544,617"/>
<area shape="rect" id="node18" href="openfile_8h.html" title="Data structures to manipulate files. " alt="" coords="837,592,957,617"/>
<area shape="rect" id="node23" href="synch_8h.html" title="Data structures for synchronizing threads. " alt="" coords="1142,152,1250,177"/>
<area shape="rect" id="node24" href="thread_8h.html" title="Data structures for managing threads. " alt="" coords="717,225,827,251"/>
<area shape="rect" id="node25" href="machine_8h.html" title="Data structures to simulate the MIPS machine. " alt="" coords="637,299,774,324"/>
<area shape="rect" id="node27" href="stats_8h.html" title="Data structures for gathering statistics about Nachos performance. " alt="" coords="267,372,362,397"/>
<area shape="rect" id="node31" href="process_8h.html" title="A process keeps track of the resources used by a running Nachos program. " alt="" coords="1063,299,1182,324"/>
<area shape="rect" id="node28" href="mmu_8h.html" title="Data structures for the MMU (Memory Management Unit) " alt="" coords="577,372,693,397"/>
<area shape="rect" id="node29" href="_a_c_i_a_8h.html" title="Data Structures to emulate an ACIA device. " alt="" coords="717,372,835,397"/>
<area shape="rect" id="node30" href="interrupt_8h.html" title="Data structures to emulate low&#45;level interrupt hardware. " alt="" coords="720,739,856,764"/>
<area shape="rect" id="node32" href="addrspace_8h.html" title="Data structures to keep track of the memory resources of executing user programs (address spaces)..." alt="" coords="1035,519,1170,544"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:acfabd79a397da2bebf0645af84a9885c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#acfabd79a397da2bebf0645af84a9885c">FreeMapSector</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:acfabd79a397da2bebf0645af84a9885c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e8a87bff0b10df73c4c8aebd74cd115"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#a1e8a87bff0b10df73c4c8aebd74cd115">DirectorySector</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a1e8a87bff0b10df73c4c8aebd74cd115"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adf9153e1a224b6785fb5e88446cfc332"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#adf9153e1a224b6785fb5e88446cfc332">decompname</a> (const char *orig_path, char *head, char *tail)</td></tr>
<tr class="separator:adf9153e1a224b6785fb5e88446cfc332"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aea4042690035ff4b4b4531ccca4dc1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#a6aea4042690035ff4b4b4531ccca4dc1">FindDir</a> (char *name)</td></tr>
<tr class="separator:a6aea4042690035ff4b4b4531ccca4dc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Routines to manage the overall operation of the file system. </p>
<p>Implements routines to map from textual file names to files.</p>
<p>Each file in the file system has:</p><ul>
<li>A file header, stored in a sector on disk (the size of the file header data structure is arranged to be precisely the size of 1 disk sector)</li>
<li>A number of data blocks</li>
<li>An entry in the file system directory</li>
</ul>
<p>The file system consists of several data structures:</p><ul>
<li>A bitmap of free disk sectors (cf. <a class="el" href="bitmap_8h.html" title="Data structures defining a bitmap. ">bitmap.h</a>)</li>
<li>A directory of file names and file headers</li>
</ul>
<p>Both the bitmap and the directory are represented as normal files. Their file headers are located in specific sectors (sector 0 and sector 1), so that the file system can find them on bootup.</p>
<p>The file system assumes that the bitmap and directory files are kept "open" continuously while Nachos is running.</p>
<p>For those operations (such as Create, Remove) that modify the directory and/or bitmap, if the operation succeeds, the changes are written immediately back to disk (the two files are kept open during all this time). If the operation fails, and we have modified part of the directory and/or bitmap, we simply discard the changed version, without writing it back to disk.</p>
<p>Our implementation at this point has the following restrictions:</p>
<ul>
<li>there is no synchronization for concurrent accesses</li>
<li>there is no hierarchical directory structure, and only a limited number of files can be added to the system</li>
<li>there is no attempt to make the system robust to failures (if Nachos exits in the middle of an operation that modifies the file system, it may corrupt the disk)</li>
</ul>
<p>Points 1 and 2 are removed in the file system assignment</p>
<p>Copyright (c) 1992-1993 The Regents of the University of California. All rights reserved. See <a class="el" href="copyright_8h.html" title="Nachos copyright notice Copyright (c) 1992-1993 The Regents of the University of California. All rights reserved. ">copyright.h</a> for copyright notice and limitation of liability and disclaimer of warranty provisions. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a1e8a87bff0b10df73c4c8aebd74cd115"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e8a87bff0b10df73c4c8aebd74cd115">&#9670;&nbsp;</a></span>DirectorySector</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DirectorySector&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acfabd79a397da2bebf0645af84a9885c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfabd79a397da2bebf0645af84a9885c">&#9670;&nbsp;</a></span>FreeMapSector</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FreeMapSector&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sectors containing the file headers for the bitmap of free sectors, and the directory of files. These file headers are placed in well-known sectors, so that they can be located on boot-up. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="adf9153e1a224b6785fb5e88446cfc332"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf9153e1a224b6785fb5e88446cfc332">&#9670;&nbsp;</a></span>decompname()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool decompname </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>orig_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>tail</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>this function returns the name of the first directory in the path given in argument, as well as the remainder of the path if we call decompname("/bin/new/halt",head,tail), we get "bin" in head and "/new/halt" in tail</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">orig_path</td><td>: the pathname we want to decompose </td></tr>
    <tr><td class="paramname">head</td><td>: the first element in the path (for instance bin) </td></tr>
    <tr><td class="paramname">tail</td><td>: the remainder of the string (for instance /new/halt) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>tail MAY point to the address of orig_path, in which case orig_path is altered </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>true if everything goes ok, otherwise, return false. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>head and tail MUST be large enough to contain the resulting strings </dd></dl>

</div>
</div>
<a id="a6aea4042690035ff4b4b4531ccca4dc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6aea4042690035ff4b4b4531ccca4dc1">&#9670;&nbsp;</a></span>FindDir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FindDir </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>this function takes a complete pathname and returns the disc sector of the fileheader of the directory.</p>
<p>IMPORTANT WARNING : name is modified : after the execution name contains only the name of the file (e.g. if we called FindDir("/bin/halt") then name is "halt" after the execution, the function returns the sector number of the directory "/bin").</p>
<p>Actually, this function does not support complete pathnames This is one of the objectives of the file system assignment</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>is the complete name (relatively to the root directory). The contents of this string will be modified! </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the sector number of the directory, or -1 in case of an error </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
